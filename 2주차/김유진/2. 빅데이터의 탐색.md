# 2.1 크로스 집계의 기본
- 크로스 테이블: 행과 열이 교차하는 부분에 숫자 데이터가 들어가는 테이블
- 트랜잭션 테이블: 보고서의 행 방향으로만 증가, 열 방향으로는 증가하지 않는 테이블
- 보고서의 바탕이 되는 데이터는 트랜잭션 테이블이여야 한다.
- 크로스 집계: 트랜잭션 테이블 > 크로스 테이블로 변환하는 과정
- Tableau 크로스 집계: 크로스 탭으로 복제
- pandas 크로스 집계: merge() - pivot_table()
- SQL 크로스 집계: 데이터가 너무 많다면 SQL로 데이터양을 감소시킬 필요가 있다. 그 뒤 BI,pandas 를 이용하여 크로스 집계
- SQL로 집계 -> 데이터 집계의 프로세스
- 시각화 도구로 크로스 집계 -> 시각화 프로세스

## 데이터 집계 > 데이터 마트 > 시각화 
- 데이터 집계와 시각화 사이에 데이터 마트가 있음
- 데이터 마트의 크기와 시각화의 퀄리티는 트레이드오프 관계
- 데이터 마트의 크기에 따라 시스템 구성 결정

# 2.2 열 지향 스토리지에 의한 고속화
## 데이터베이스 지연을 줄이기
- 데이터 레이크 > 데이터 마트: 데이터 집계, 수분~수시간
- 데이터 마트 > 시각화 도구: 크로스 집계, 수초 단위 응답
- 데이터 마트는 가급적 지연이 적은 데이터베이스가 필요
  - 모든 데이터를 메모리에 올리는 것
  - 압축과 분산(MPP;대규모 병렬 처리)

## 열 지향 데이터베이스 접근
- 일반적 RDB는 행 지향 데이터베이스
- 데이터 분석에 사용되는 데이터베이스는 열 지향 데이터베이스, 칼럼 지향 데이터베이스
- 일정 시간에 처리할 수 있는 데이터의 양=처리량;throughput
- 데이터 처리가 끝날 때까지의 대기 시간=지연
- 행 지향 데이터베이스에서는 각 행을 하나의 덩어리로 디스크에 저장(데이터 추가가 효율적)
  - 데이터 검색 고속화를 위해 인덱스를 만든다
  - 어떤 칼럼이 사용될지 모르는 데이터분석에서는 인덱스를 작성해도 도움이 되지 않음 > 디스크 I/O에 의한 성능저하
- 열 지향 데이터베이스는 데이터를 칼럼 단위로 정리
  - 압축 효율이 우수
  - 행 지향 데이터베이스와 달리 필요한 칼럼만을 로드할 수 있음

## MPP 데이터베이스의 접근 방식
- MPP는 하나의 쿼리를 다수의 작은 태스크로 분해, 가능한 한 병렬로 실행
- MPP를 사용한 데이터집계는 CPU 코어 수에 비례하여 고속화
- 병목현상을 예방하기 위해서 데이터가 고르게 분산되어 있어야 함
- MPP 데이터베이스와 대화형 쿼리 엔진을 둘 다 사용할 수 있지만 열 지향의 스토리지 형식으로 저장해야 한다는 것은 동일하다. 

# 2.3 애드 혹 분석과 시각화 도구
## Jupyter Notebook
- matplotlib 라이브러리를 사용
- BI는 시간을 들여 차분히 데이터를 보고 싶은 경우에 적합
- 대시보드는 정해진 지표의 일상적인 변화 모니터링에 적합

## BI 도구
- 하나의 테이블에서 다수의 대시보드 작성
  1. 전체 숫자를 파악할 수 있는 리포트
  2. 중요 지표를 위한 높은 일관성이 있는 대시보드
  3. 대화형 대시보드로 조건을 선택해 집계 

# 2.4 데이터 마트의 기본 구조
## 시각화에 적합한 데이터 마트(OLAP)
- OLAP(online analytical processing)
  - 다차원 모델의 데이터 구조를 MDX 등의 쿼리 언어로 집계
  - 다차원 데이터를 OLAP cube라고 부르며, 그것을 크로스 집계하는 구조가 OLAP이다.
- 최근에는 BI 도구와 MPP 데이터베이스를 조합하여 크로스 집계하는 경우가 증가
- MPP 데이터베이스에서 비정규화 테이블 준비 > BI 도구에서 시각화

## 테이블 비정규화
- 마스터: 트랜잭션에서 참고되는 각종 정보, 상황에 따라 다시 쓰임(디멘전 테이블)
- 트랜잭션: 시간과 함께 생성되는 데이터 기록, 한 번 기록하면 변화하지 않음(팩트 테이블)
- 스타 스키마: 데이터 마트를 만들 때는 팩트 테이블을 중심으로 여러 디멘전 테이블을 결합
- 팩트 테이블을 최대한 작게 하는 것이 고속화에 있어 중요 > 키를 제외한 나머지를 디멘전 테이블로 옮긴다
- 비정규화 테이블: 최근에는 열 지향 스토리지를 사용하므로 처음부터 팩트 데이블에 모든 칼럼을 포함하고, 쿼리 실행 시 테이블 결합을 하지 않는다.
- 스타 스키마에서 비정규화 테이블로 변화, 데이터 마트는 비졍규화 테이블이 가장 단순하고 효율적

## 다차원 모델 시각화에 대비하여 테이블 추상화하기
- 비정규화 테이블을 다차원 모델에 의해 추상화한다.
- 크로스 집계에서 행과 열 이용하는 칼럼: 디멘전
- 숫자 데이터와 그 집계 방법 칼럼: 측정값
