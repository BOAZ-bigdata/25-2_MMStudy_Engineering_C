# 빅데이터를 지탱하는 기술: 2장 빅데이터의 탐색

# [2주차] 빅지기 2장 빅데이터의 탐색

기간: BASE, 방학
선택: 멘멘
활동 날짜: 2025년 7월 23일

<aside>
💡

데이터를 시각화하는 환경을 정비함으로써 대량의 데이터를 효율적으로 탐색할 수 있도록 준비한다 

</aside>

# 2-1. 크로스 집계의 기본

---

## 2-1-1. 트랜잭션 테이블, 크로스 테이블, 피벗 테이블

- 크로스 테이블(cross table): 행과 열이 교차하는 부분에 숫자 데이터가 들어가는 형태
    - 예) 표 (1): 어떤 상품의 매출을 정리한 보고서
    - 보기 편하지만 데이터베이스에서 다루기 어려운 데이터 형식
        
        → 데이터베이스에서 새로운 행을 추가하는 것은 간단하지만, 열을 늘리는 것은 간단하지 않기 때문 
        
- 트랜잭션 테이블(transaction table): 행 방향으로만 증가하고, 열 방향으로는 데이터를 증가시키지 않는 형태
    - 예) 표 (2)
- 크로스 집계(cross tabulation): 트랜잭션 테이블에서 크로스 테이블로 변환하는 과정
    - 소량의 데이터를 크로스 집계할 때 편리한 것 → 스프레드시트의 피벗 테이블(pivot table) 기능

![image.png](./assert/2장/image.png)

## 피벗 테이블 기능에 의한 크로스 집계

- 열: 매출일
- 행: 점표 ID와 상품 ID
- 값: 금액
- 보통 합계로 계산, 그 외 평균, 최댓값, 이전 값과의 차이 등을 계산 가능

![image.png](./assert/2장/image%201.png)

## 2-1-2. 룩업 테이블

- 트랜잭션 테이블을 다른 테이블과 결합하고 싶은 경우
    - 예) 상품 ID를 사용해 상품명과 상품 카테고리를 참고하는 형태
    - 이때, 룩업 테이블(lookup table)을 활용

![image.png](./assert/2장/image%202.png)

### BI 도구에 의한 크로스 집계

- 자주 데이터를 살펴볼 때는 엑셀보다 BI 도구를 사용하는 것이 좋음

![image.png](./assert/2장/image%203.png)

### Pandas에 의한 크로스 집계

- 스크립트로 크로스 집계를 실행하고 싶다면 pandas가 편리함
- 2개의 테이블을 결합할 경우 → merge()
    
    ![image.png](./assert/2장/image%204.png)
    
- 크로스 집계 → pivot_table( )
    
    ![image.png](./assert/2장/image%205.png)
    
- 자체적으로 함수를 만들어서 상품 카테고리를 생성
    
    ![image.png](./assert/2장/image%206.png)
    

## 2-1-3. SQL에 의한 테이블의 집계

- 피벗 테이블에 의한 크로스 집계의 한계점: 데이터의 양이 너무 많으면 처리할 수 없다
- BI 도구, pandas의 한계점: 수백만 레코드 집계가 가능하지만, 그 이상이 되면 너무 느려진다

→ 대량의 데이터를 크로스 집계하려면 SQL의 집계 함수를 사용해 먼저 데이터양을 감소하게 할 수 있다

- 예) 업무 데이터베이스에 판매 이력이 저장되어 있는 경우, 모두 꺼내 바로 크로스 집계를 하는 것이 아닌, 먼저 SQL로 집계 → 그 후 크로스 집계
    
    ![image.png](./assert/2장/image%207.png)
    
- SQL과 시각화 도구를 결합: (1) 데이터 집계의 프로세스 + (2) 시각화 프로세스
    
    ![image.png](./assert/2장/image%208.png)
    

## 2-1-4. 데이터 집계 → 데이터 마트 → 시각화

**: 시스템 구성은 데이터 마트의 크기에 따라 결정된다** 

- 데이터의 집계와 시각화 사이에 있는 데이터 마트
- 데이터 마트는 적당한 규모를 유지하는 것이 중요함
    - 작을 수록 시각화의 프로세스에서 할 수 있는 것이 적어짐
    - 데이터 집계의 프로세스에서 가능한 한 많은 정보를 남기게 될 경우, 데이터 마트가 거대화되어 결국 좋은 시각화를 할 수 없게 됨
    
    ⇒ 트레이드 오프 관계, 데이터 마트의 크기에 따라 시스템 구성이 결정됨 
    

# 2-2. 열 지향 스토리지에 의한 고속화

---

## 2-2-1. 데이터베이스의 지연을 줄이기

- 데이터의 양 증가 → 집계에 걸리는 시간 증가
- 초 단위 데이터 집계를 위해 시스템 설계: 3계층 시스템
    
    원 데이터는 용량적인 제약이 적어 대량의 데이터 처리가 가능한 데이터 레이크, 데이터 웨어하우스에 저장
    
    → 원하는 데이터를 추출해 데이터 마트를 구축 (초 단위 응답이 가능하도록 함)
    

![image.png](./assert/2장/image%209.png)

### 데이터 처리의 지연

**: 지연이 적은 데이트 마트 작성을 위한 기초 지식** 

- 데이터 처리의 응답이 빠르다 = 대기 시간(latency)이 적다 = 지연이 적다
- 데이터 마트는 지연이 적은 데이터베이스가 있어야 한다
- 가장 간단한 방법, 모든 데이터를 메모리에 올리는 것
    - 예) 한 레코드의 크기가 500 바이트이고, 천만 레코드인 경우 → 5GB
        
        ⇒ MySQL, PostgreSQL 등 일반적인 RDB가 적합!
        
- 하지만, 메모리가 부족할 경우 급격히 성능이 저하되고, 집계에서 항상 디바이스 I/O가 발생한다고 가정할 경우 어떻게 효율화할 것인가?

### ‘압축’과 ‘분산’에 의해 지연 줄이기

: MPP 기술

- **MPP(massive parallel processing: 대규모 병렬 처리)**: 분산된 데이터를 읽어 들이기 위해 멀티 코어를 활용하면서 디스크 I/O를 병렬 처리하는 아키텍쳐
    - 고속화를 위해  데이터를 가능한 한 작게 압축하고, 여러 디스크에 분산함으로써 데이터 로드에 따른 지연을 줄일 수 있음
    - Amazon Redshift, Google BigQuery 등
- MPP는 데이터 집계에 최적화 → 데이터 웨어하우스, 분석용 데이터베이스에 많이 사용

## 2-2-2. 열 지향 데이터베이스 접근

**: 칼럼을 압축하여 디스크 I/O를 줄이기**

- 빅데이터는 대부분 디스크 상에 존재하고, 쿼리에 필요한 최소한의 데이터만을 가져오면서 지연이 줄어들게 됨 → 칼럼 단위로 데이터 압축
- 행 지향 데이터베이스(row-oriented database): 레코드 단위의 읽고 쓰기에 최적화된 데이터베이스 (일반적으로 업무 시스템 등에서 사용)
- 열 지향 데이터베이스(column-oriented database): 칼럼 단위의 집계에 최적화된 데이터베이스
    - 예) Amazon Redshift, Teradata

<aside>
💡

**처리량과 지연 시간**

- 데이터 처리의 성능 표시 방식
    - 처리량(throughput): 일정 시간에 처리할 수 있는 데이터의 양
        - 배치 처리 등 대규모 데이터 처리 시 중요
    - 지연: 데이터 처리가 끝날 때까지의 대기 시간
        - 애드 혹 데이터 분석 등에서 중시
- 데이터 웨어하우스, 데이터 레이크는 대량의 데이터 처리를 위한 높은 처리량을 중시
- 데이터 마트는 지연 시간 단축을 중요시
- + 충분한 메모리 준비, 디스크 I/O 절감이 필수적

![image.png](./assert/2장/image%2010.png)

</aside>

### 행 지향 데이터베이스

: 각 행이 디스크 상에 일련의 데이터로 기록된다 

![image.png](./assert/2장/image%2011.png)

- 행 지향 데이터베이스는 테이블의 각 행을 하나의 덩어리로 디스크에 저장
- 새 레코드를 추가할 때, 파일의, 끝에 데이터를 쓰는 것 뿐 → 빠르게 추가 가능
    
    → 특징: 매일 발생하는 대량의 트랜잭션을 지연 없이 처리하기 위해 데이터 추가를 효율화
    
- 행 지향 데이터베이스는 검색 시 저장된 모든 데이터를 로드해야 원하는 레코드를 찾을 수 있기 때문에, 검색을 고속화하기 위해 인덱스를 만듦.
    
    → 하지만 데이터 분석에서는 어떤 컬럼이 사용되는지 미리 알 수 없음 → 큰 도움 X
    
    ⇒ 인덱스에 의지하지 않는 고속화 기술 필요
    

### 열 지향 데이터베이스

: 칼럼마다 데이터를 모아두기

- 데이터 분석 시 종종 일부 컬럼만이 집계 대상이 됨
    - 예) 점포의 총매출액 확인 시, 고객 정보 필요 X
    - 행 지향 데이터베이스에서는 레코드 단위이기 때문에 필요 없는 열까지 로드됨
    
    → 열 지향 데이터베이스에서는 데이터를 컬럼 단위로 로드해 디스크 I/O를 줄일 수 있음
    

![image.png](./assert/2장/image%2012.png)

- 열 지향 데이터베이스의 데이터 압축 효율 우수
    - 같은 컬럼에서 유사한 데이터가 나열될 경우, 더욱 작게 압축 가능
    - 압축되지 않은 행 지향 데이터베이스와 비교 시 1/10 이하로 압축 가능

## 2-2-3. MPP 데이터베이스의 접근 방식

**: 병렬화에 의해 멀티 코어 활용하기**

- 쿼리 지연을 줄일 또 다른 방법: MPP 아키텍처에 의한 데이터 처리의 병렬화
    - MPP(massive parallel processing: 대규모 병렬 처리): 분산된 데이터를 읽어 들이기 위해 멀티 코어를 활용하면서 디스크 I/O를 병렬 처리하는 아키텍쳐
- 행 지향 데이터베이스의 경우, 하나의 쿼리는 하나의 스레드에서 실행됨
    - 많은 쿼리를 동시에 실행하며 여러 개의 CPU 코어를 사용 가능하나, 개별 쿼리가 분산 처리되는 것은 XX
    - 행 지향 데이터베이스의 경우, 각 쿼리는 충분히 짧은 시간으로 끝나는 것으로 생각, 하나의 쿼리를 분산 처리하는 상황은 가정 X
- 열 지향 데이터베이스의 경우, 디스크에서 대량의 데이터를 읽기 때문에 1번의 쿼리 실행 시간이 길어짐
    - 압축된 데이터의 전개는 CPU 리소스를 필요로 하기 때문에 멀티 코어를 활용한 고속화가 좋음
- MPP: 하나의 쿼리를 다수의 작은 태스크로 분해 및 (가능한 만큼) 병렬 실행
    - 예) 1억 레코드로 이루어진 테이블의 합계 계산을 위해 10만 레코드씩 1,000개의 태스크로 나눔

![image.png](./assert/2장/image%2013.png)

### MPP 데이터베이스와 대화형 쿼리 엔진

- 쿼리가 잘 병렬화 → MPP를 사용한 데이터 집계는 CPU 코어 수에 비례하여 고속화
    - 주의: 디스크로부터 로드 과정에서 병목 현상이 발생 가능하니 데이터가 고르게 분산되어 있어야 함
- MPP 구조상, 고속화를 위해 CPU와 디스크 모두를 균형 있게 늘려야 함
    
    → 일부는 하드웨어와 소프트웨어가 통합된 제품으로 제공 
    
    ⇒ 하드웨어 수준에서 데이터 집계에 최적화된 데이터베이스: MPP 데이터베이스
    
- MPP의 아키텍처는 Hadoop과 함께 사용되는 대화형 쿼리 엔진으로 채택되고 있음
    - 이때 분산 스토리지의 역할은 데이터 저장이지만, 열 지향 압축이 아닌 경우 MPP 데이터베이스와 동등한 성능이 될 수 없음
        
        → Hadoop 상에서 열 지향 스토리지를 개발 중…
        
        ⇒ (추가 정보 수집) 현재 Hadoop과 함께 잘 쓰이는 열 지향 포맷: Parquet, ORC, Avro
        

<aside>
💡

**리소스 소비를 제한하기**

- 열 지향 스토리지 X MPP에 의한 고속화와 주의점
- 열 지향 스토리지와 MPP 개념의 결합으로 데이터 집계 고속화가 가능해졌으나, 이에 따른 쿼리의 리소스 사용량이 증가
    
    → 하나의 쿼리가 다수의 코어를 활용 
    
    ⇒ 시스템의 모든 컴퓨터 리소스를 쉽게 소진하게 됨
    
- 과부하가 발생 가능하기 때문에, 시스템 리소스를 제한하거나 예상치 못한 부하가 발생하고 있지는 않은지 모니터링 필요
</aside>

# 2-3. 애드 혹 분석과 시각화 도구

---

## 2-3-1. Jupyter Notebook에 의한 애드 혹 분석

- Jupyter Notebook(주피터 노트북): 노트북 안에서 파이썬, 루비, R 언어 등 스크립트 언어를 실행할 수 있는 오픈소스 대화형 도구
    - 마크다운 형식으로 주석을 넣거나 사진, 수식 등을 포함 가능
    - 애드 혹 분석, 크로스 집계 등 모두 노트북 안에서 실행 가능
    - 웹 애플리케이션, 로컬 호스트 모두에서 동작
- matplotlib: 파이썬 시각화 라이브러리
- 데이터 처리를 위한 일련의 태스크를 노트북에 정리한 뒤 Run All 을 통해 모든 셀을 순서대로 실행 가능

## 2-3-2. 대시보드 도구

: 정기적으로 집계 결과를 시각화하기

- 대시보드 도구는 새로운 그래프를 쉽게 추가하는 것이 보다 중요
    
    → 최신의 집계 결과 확인, 정해진 지표의 일상적인 변화를 모니터링하기에 적합 
    
- 오픈 소스의 대시보드 도구 → Redash, Superset
- 실시간 시각화 도구 → Kibana

## 2-3-3. BI 도구

: 대화적인 대시보드

- BI 도구는 장기적인 데이터 추이를 시각화하거나, 집계의 조건을 세부적으로 바꿀 수 있는 대시보드를 만들 때 적합
- BI 도구는 대화형 데이터 탐색이 보다 중요
    
    → 집계의 기반이 되는 로우 데이터를 표시하거나 차분히 데이터를 보기에 적합
    
- BI 도구의 시각화 과정: 데이터 마트에 테이블을 만든 뒤 그에서 파생된 다수의 대시보드가 생겨나는 것
    
    ![image.png](./assert/2장/image%2014.png)
    

# 2-4. 데이터 마트의 기본 구조

---

![image.png](./assert/2장/image%2015.png)

## 2-4-1. 시각화에 적합한 데이터 마트 만들기

- OLAP(online analytical processing): 데이터 집계를 효율화하는 접근 방법 중 하나
    - OLAP 큐브: 다차원 모델의 데이터 구조를 MDX 등의 쿼리 언어로 집계해 데이터 분석을 위해 만들어진 다차원 데이터
    - OLAP: OLAP 큐브를 크로스 집계하는 구조
    - BI 도구는 본래 OLAP 구조를 사용해 데이터를 집계하기 위한 소프트웨어

### MPP 데이터 베이스와 비정규화 테이블

- 최근, MPP 데이터베이스와 인 메모리 데이터베이스 등의 보급으로 사전에 계산해둘 필요성 X
    
    → BI 도구와 MPP 데이터베이스를 조합해 크로스 집계하는 경우 증가
    
- BI 도구에서 만들고 싶은 그래프에 맞춰 다차원 모델 설계
    
    → MPP 데이터베이스에 다차원 모델 개념 X
    
    ⇒ 비정규화 테이블 준비 ⇒ OLAP와 동등한 시각화 실현 가능
    

## 2-4-2. 테이블을 비정규화하기

- 데이터베이스 설계 시 테이블의 속성에 따른 구분
    - 트랜잭션 테이블: 시간과 함께 생성되는 데이터를 기록
        - 한 번 기록하면 변화 X
    - 마스터 테이블: 트랜잭션에서 참고되는 각종 정보
        - 상황에 따라 다시 쓰임
    - 예) 관계형 모델에 의한 테이블 관계
        - 트랜잭션: 판매 이력
        - 마스터: 고객, 점포, 상품
        
        ![image.png](./assert/2장/image%2016.png)
        

### 팩트 테이블과 디멘전 테이블

- 데이터 웨어하우스에서 테이블의 속성에 따른 구분
    - 팩트 테이블: 트랜잭션처럼 사실이 기록된 것
    - 디멘전 테이블: 마스터처럼 트랜잭션에서 참고되는 각종 정보\

### 스타 스키마와 비정규화

- 데이터 마트를 만들 경우, 여러 테이블을 비정규화하는 것이 좋음
- 스타 스키마: 팩트 테이블을 중심으로 여러 디멘전 테이블을 결합한 형태
    - 단순해 이해하기 쉽고, 데이터 분석도 쉽게 할 수 있음
    - 성능 측면에서 팩트 테이블을 가능한 한 작게 하는 것이 고속화에 있어서 중요

![image.png](./assert/2장/image%2017.png)

## 2-4-3. 다차원 모델 시각화에 대비하여 테이블을 추상화하기

- 다차원 모델의 컬럼 구분
    - 디멘전: 주로 날짜 및 문자열의 값, 크로스 집계의 행이나 열로서 사용됨
    - 측정값: 숫자 데이터와 그 집계 방법을 정의하는 것 (sum, max 같은 집계 함수와 함께 사용)

![image.png](./assert/2장/image%2018.png)