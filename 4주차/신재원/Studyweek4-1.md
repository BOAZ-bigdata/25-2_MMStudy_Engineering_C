워크플로 관리 

워크플로 관리 기능은 다수의 업무 시스템 내장 

Daily Task 관리, 정기적인 배치 처리 , 비정상 상태 감지

워크플로 관리 도구 
Airflow Luigi Prefect - 스크립트 기능 중심 : 유연함 (변수 제어구문 사용가능 )

Dagster Kestra - 데이터 Asset 중심 

데이터 파이프라인 
- 실행 과정에서 데이터를 잇달아 이동하면서 정해진 처리를 반복. 

이떄 실행되는 개별 처리를 Task 라고 한다. 

워크플로 전용 관리 도구를 사용하는 이유 : Task 실행의 실패 관리 

파이프라인이 복잡하거나 Task 수가 많으면 실패를 관리하기 어렵다. 

ETL 프로세스에는 스크립트형의 도구 , SQL 실행에는 선언형 도구등으로 나누어 사용 

빅데이터는 다양한 오류 발생 가능 (네트워크 일시적 장애, 하드웨어 장애, 스토리지 용량 부족, 쿼리 증가, 성능 부족 )
- 오류에 강한 워크플로를 구축해야한다!

기본적으로 워크플로 관리에선 오류로 부터 자동 회복할수 있다는 점은 고려하지 않음 

복구를 전제한 태스크 설게 

일련의 태스크 = 플로우 , 태스크는 되도록 작게 유지 

각 플로우 에는 고정 파라미터(=조건) 존재 -> 복구의 기초 

간단한 복구 = 태스크 단위의 자동적인 재시도 - 재시도 횟수 , 시간 간격 주의 

백필 

파라미터에 포함된 일시를 순서대로 바꿔가며 플로우 전체를 처음부터 연속 실행하는 것 

성능상의 주의가 필요. 

복구의 전제 : 재실행의 안전성 (실행에 실패했을때 도중 경과가 사라지지 않으면 
데이터가 혼재하는 문제 발생)

이를 쓰기가 필요한 수만큼 태스크를 나눈다 = 원자성 조작 

동일한 태스크를 여러번 실행해도 동일한 결과가 나오게 한다 = 멱등성 

멱등성의 예시 SQL 이라면 테이블을 삭제한 후에 다시 만들기 

원칙적으로 항상 데이터를 덮어써야하나, 일반적으로 워크플로으 각 태스크는 추가 또는 치환을 실시한다. 

그러나 현실에서는 항상 멱등한 태스크를 구현할 수 없다.
과거의 모든 데이터를 치환하면 멱등하게 되긴 하지만, 그러면 부하가 커진다. 

그래서 존재하는 것이 테이블 파티셔닝 
ex) 테이블을 1시간단위로 파티션 분할 후 치환 

태스크 오류 

-언제 끝나는지 알 수 있는 오류 
: 지수 백오프 (한 오류만을 대상으로 재시도 횟수 늘림, 간격 늘림)
-언제 끝나는지 알 수 없는 오류 
: 타임 아웃 (시스템 자원 부족등의 문제)


복잡한 플로우에서는 하나의 테이블에 여러번 데이터를 써넣을 때도 있다.
 이 경우 추가를 반복하지 않고 중간 테이블을 만들어 처리 후, 마지막에 목적 테이블에 한번에 추가하는 것이 안전하다.

 최악의 경우에도 중간 테이블만 수정하면 됨 

워크플로 전체를 멱등으로 하기 

데이터 파이프라인을 안정적으로 운용하기 위해서는 거기에 포함된 태스크나 플로우를 가능한 한 멱등으로 해야 한다. 

각 태스크를 멱등으로 하는 것이 이상적이지만, 필수는 아니다. 

태스크 큐 












